# Visual System Stimulation Model

This repository implements the pipeline that estimates the perception generated by electrically stimulating the visual system from depth and RGB images. The code demonstrates the model's capability to generate the estimated perception and reconstruct visual experiences under various conditions.

## Table of Contents

- [Overview](#overview)
- [Code Structure](#code-structure)
- [Installation](#installation)
- [Getting started](#getting-started)
  - [Generate Receptive Field Locations](#generate-receptive-field-locations)
  - [Reconstruct Perceived Image](#reconstruct-perceived-image)
  - [Alter Perception](#alter-perception)
- [License](#license)

## Overview

This repository provides software that simulates the perception of a visual system when electrically stimulated to induce a given target image. A recurrent neural network classifies relevant objects in the scenes, which are then used to mask a depth image, making each object appear brighter the closer it is to the camera. The geometrical model, which represents the relationship among receptive field centers in the visual field, soma locations in the retina, and fiber locations in the optic nerve, is used to estimate the ideal pattern of retinal ganglion cell (RGC) activation needed to induce the desired stimulus.

Afterward, a simplified stimulation paradigm is applied, and the geometrical model is used again to estimate the perceived image following this stimulation. The code allows for testing these paradigms under various conditions, among which the following:

- **Local shuffling**: Swaps the locations of some pairs of RGCs.
- **Global shuffling**: Swaps the locations of some groups of RGCs.
- **Site damage**: Simulates the malfunction of certain sites. If a site is damaged, it is assumed that it cannot be turned "ON," meaning none of the corresponding RGCs can be activated.

For further details, please refer to the corresponding paper.

## Code Structure

The main folder of this repository, `code`, contains all the files related to the model and its demonstration:

- **`optic_geom.py`**: Implements the geometrical model, representing the relationship between receptive field centers, somas, and fibers.
  
- **`ideal_stimulation.py`**: Contains the code for the simplified stimulation of the visual system and for simulating damage to sites and death of RGCs.
  
- **`modify_perception.py`**: Provides functions to alter the perception by applying local and global shuffling. Local shuffling , while global shuffling refers to the swap of two groups of fibers.

## Installation

This code was tested using Python 3.10.11 and with the dependencies listed in `requirements.txt`. You can install these dependencies by running:

```bash
pip install -r requirements.txt
```

## Getting started

You can run any of the provided demo files to see the features of the model in action:

```bash
python code/demo_generate_locations.py
python code/demo_reconstruct_image.py
python code/demo_alter_perception.py
```

To run `demo_reconstruct_image.py` or `demo_alter_perception.py`, make sure that you have the file `optic_geom_variables.pkl`. This file is generated by `demo_generate_locations`.

### Generate Receptive Field Locations

- **`demo_generate_locations.py`**: Generates the locations of receptive field centers of retinal ganglion cells (RGCs) in the visual field, their soma locations in the retina, and their fiber locations in the optic nerve section. The settings for this demo are listed in `settings.py`.

### Reconstruct Perceived Image

- **`demo_reconstruct_image.py`**: Uses the model to reconstruct the perceived image when attempting to stimulate the visual system to recreate a target image.

### Alter Perception

- **`demo_alter_perception.py`**: Reconstructs the perceived image for a few target images (as in `demo_reconstruct_image.py`), adding local and global shuffling and simulating the malfunction of some sites.
